# 📊 FruitOPS 商業決策邏輯總整理

## 系統概述
本系統跨越 6 個主要頁面，整合了多個商業決策模型與理論依據。以下為完整的決策邏輯總整理。

---

## 🎯 各頁面決策邏輯對應表

### 1️⃣ 儀表板 (Dashboard.tsx) 📊

#### 決策模型：決策建議卡片 + 庫存分析
**理論依據**：庫存管理的 ABC 分類法 + 補貨點計算

#### 商業決策邏輯

| 決策點 | 公式/邏輯 | 目的 | 建議行動 |
|-------|---------|------|--------|
| **補貨建議** | `inventory.quantity < 50` | 防止缺貨 | 優先補貨低於50件的產品 |
| **銷售推進** | 計算所有 pending 訂單 | 加速流轉 | 聯繫客戶確認、加快揀貨 |
| **儲位調整** | `high_stock > 200 && low_stock < 50` | 優化倉儲 | 調整高庫存至不同儲位或降價 |
| **庫存水位** | `avg_stock = SUM(qty) / product_count` | 監控整體 | 若平均<80件，建議採購 |
| **高庫存警示** | `high_stock_count > 3` | 識別滯銷品 | 考慮促銷、甚至停售 |
| **通路分佈** | `COUNT(orders) BY channel` | 瞭解銷售管道 | 加強銷售績效好的通路 |
| **收入趨勢** | `SUM(total) BY order_date` | 營收追蹤 | 與預算目標對比 |

#### 顯示內容
- 「今日決策建議」卡片 4 個建議
- 庫存水位圖表
- 通路銷售圓餅圖
- 庫存管理細節建議

---

### 2️⃣ 智慧生產管理 (Production.tsx) 🌳

#### 決策模型：農業健康度評分 + 決策邏輯樹
**理論依據**：作物健康度管理 (Crop Health Index) + 預防性農業

#### 商業決策邏輯

| 決策點 | 公式/邏輯 | 目的 | 建議行動 |
|-------|---------|------|--------|
| **健康良好** | `health >= 85 && status == 'Active'` | 維持穩定 | 維持每 7 天巡檢、觀測病蟲害 |
| **中度注意** | `60 <= health < 85` | 主動介入 | 施肥/葉面追肥、加強病蟲監測、檢查灌溉 |
| **優先處理** | `health < 60 \|\| status == 'Maintenance'` | 緊急響應 | 修剪病枝、檢查排水/灌溉、必要時施藥 |
| **維護模式** | `status == 'Maintenance'` | 人為介入 | 完成修剪/補苗/支架檢查後轉回運作中 |
| **休耕管理** | `status == 'Fallow'` | 長期規劃 | 計畫覆蓋作物或土壤改良 |

#### 顯示內容
- 地塊狀態卡片（含健康度指標、決策建議）
- 農務日誌表格
- 決策邏輯展示區

---

### 3️⃣ 分級庫存 (Inventory.tsx) 📦

#### 決策模型：庫存分層管理 + 補貨點計算
**理論依據**：Economic Order Quantity (EOQ) + Just-in-Time (JIT) 思想

#### 商業決策邏輯

| 決策點 | 公式/邏輯 | 目的 | 建議行動 |
|-------|---------|------|--------|
| **低庫存警示** | `quantity < 50` | 防缺貨 | 立即補貨 |
| **適量庫存** | `50 <= quantity <= 200` | 正常運營 | 保持現狀 |
| **過度庫存** | `quantity > 200` | 避免滯銷 | 促銷降價或轉移儲位 |
| **品級分布** | 按 A/B/C 等級統計 | 品質管理 | A 級用於高端、B/C 級用於標準通路 |
| **儲位管理** | `inventory BY location` | 倉儲優化 | 冷藏品優先放冷庫、常溫放倉庫 |
| **周轉率** | `COGS / Avg_Inventory` | 資金效率 | 提高周轉率降低持有成本 |

#### 顯示內容
- 按產品/品級的庫存摘要
- 儲位分布
- 移位/新增表單

---

### 4️⃣ 全通路訂單 (Orders.tsx) 🛒

#### 決策模型：訂單優先化 + 通路別銷售分析
**理論依據**：通路管理 (Multi-channel Strategy) + 訂單緊急度評分

#### 商業決策邏輯

| 決策點 | 公式/邏輯 | 目的 | 建議行動 |
|-------|---------|------|--------|
| **訂單優先度** | 依 status: Pending > Confirmed > Shipped | 流程加速 | Pending 優先確認、Confirmed 優先揀貨 |
| **通路分析** | `COUNT(orders) BY channel` | 通路績效 | 重點投入高成交通路 |
| **客戶單價** | `total / item_count` | 客單價分析 | 優化定價策略 |
| **庫存可用性** | `check inventory before picking` | 避免缺貨 | 無庫存訂單優先採購或取消 |
| **品級配置** | `使用預設價格表` | 標準化定價 | A 級 ¥400、B 級 ¥280、C 級 ¥180 |
| **揀貨完成度** | `picking_items == order_items` | 交付品質 | 100% 滿單率目標 |

#### 顯示內容
- 訂單列表（分狀態過濾）
- 通路/客戶搜尋
- 揀貨確認模態框
- 狀態流轉（Pending → Confirmed → Shipped → Completed）

---

### 5️⃣ 顧客關係管理 (CRM.tsx) 👥

#### 決策模型：RFM 客戶分級 + 分段行銷策略
**理論依據**：RFM 分析法 (Recency, Frequency, Monetary) + 客戶生命周期價值 (CLV)

#### 商業決策邏輯 - RFM 分級閾值

| 客戶分級 | 定義 | R (天) | F (次) | M (金額) | 行銷策略 |
|--------|------|-------|-------|---------|--------|
| **VIP** 🟣 | 最有價值 | ≤ 60 | ≥ 5 | ≥ $100k | 專屬預購會、高端禮盒、客製化服務、生日優惠 |
| **Stable** 🔵 | 穩定客群 | ≤ 90 | ≥ 3 | ≥ $50k | 定期優惠、新品搶先看、會員權益 |
| **Regular** ⚪ | 一般客戶 | > 90 | 1-2 | < $50k | 保持互動、提升回購頻率、季節促銷 |
| **New** 🟢 | 新客 | N/A | 0 | $0 | 首次購買折扣、產品推薦、導購 |
| **At Risk** 🔴 | 流失風險 | > 180 | 曾購 | 任意 | 回饋優惠、專人聯繫、節日促銷、撿回計畫 |

#### 決策邏輯

| 決策點 | 邏輯/公式 | 目的 | 建議行動 |
|-------|---------|------|--------|
| **RFM 計算** | 自動分析客戶購買行為 | 精準分段 | 每月計算一次，根據變化調整策略 |
| **分級更新** | 手動/自動應用 | 保持準確 | VIP 推送專屬訊息、At Risk 啟動回饋 |
| **行銷預算分配** | VIP 40% > Stable 30% > Regular 20% > New 10% | 資源最優 | 高價值客群優先投資 |
| **流失風險預警** | Recency > 180 && Frequency > 0 | 主動挽回 | 聯繫機制、回饋金、折扣碼 |
| **新客轉化** | New → Regular (首次滿 $100) | 培育轉化 | 首購折扣、推薦獎勵 |

#### 顯示內容
- 客戶卡片網格
- RFM 計算/應用功能
- 快速分級調整下拉選單
- 客戶詳細檔案（訂單紀錄、分級依據）

---

### 6️⃣ AI 顧問 (GeminiAdvisor.tsx) 🤖

#### 決策模型：自然語言 AI 建議生成
**理論依據**：生成式 AI + 上下文感知決策

#### 商業決策邏輯

| 決策點 | 邏輯 | 目的 | 建議行動 |
|-------|------|------|--------|
| **預定建議提示** | 4 個常見問題範本 | 引導使用 | 根據庫存、銷售、成本提問 |
| **上下文提供** | 庫存摘要、訂單摘要、VIP 客戶清單 | 精準回答 | 讓 AI 提供數據驅動的建議 |
| **決策建議** | 根據實時數據生成 | 輔助決策 | 促銷策略、採購計畫、成本優化 |
| **自然語言互動** | 自由提問界面 | 易用性 | 非技術人員可用 |

#### 顯示內容
- 浮動 FAB 按鈕
- 預定提示清單
- 自由文字輸入框
- AI 回應顯示區

---

## 🍎 水果生產週期定義

### 新新果園水果品項與生產週期

#### 核心水果品項

| 水果名稱 | 品級 | 主要產季 | 開始月 | 結束月 | 週期天數 | 備註 |
|--------|------|--------|-------|-------|--------|------|
| **水蜜桃** | A/B/C | 夏季 | 6 | 9 | 120 | 6月中旬上市，9月下旬停售 |
| **水梨** | A/B/C | 秋季 | 8 | 11 | 120 | 8月上旬上市，11月中旬停售 |
| **蜜蘋果** | A/B/C | 秋冬季 | 9 | 12 | 120 | 9月下旬上市，12月中旬停售 |
| **柿子** | A/B | 秋冬季 | 10 | 1 | 150 | 10月上旬上市，1月下旬停售 |

### 詳細生產週期時間表

#### Q2 (4-6月) - 春夏交界
- **水蜜桃**：準備期（施肥、套袋）
  - 4月：花期管理、人工授粉
  - 5月：疏果、施肥
  - 6月中旬：上市開始

#### Q3 (7-9月) - 盛夏秋初
- **水蜜桃**：銷售旺季（6月中 - 9月下）
  - 7月：盛產期、優質果率最高
  - 8月：全面產季、冷藏備貨
  - 9月中下旬：產季結束、準備清理
  
- **水梨**：準備期開始（8月上旬上市）
  - 8月：上市初期、品質逐步改善
  - 9月：進入盛產

#### Q4 (10-12月) - 秋冬季
- **水梨**：銷售持續（8月 - 11月）
  - 10月：產季中期、品質最穩定
  - 11月中旬：產季結束

- **蜜蘋果**：銷售季（9月下 - 12月中）
  - 9月下旬：上市初期
  - 10-11月：盛產期、品質最優
  - 12月中旬：產季結束

- **柿子**：銷售季開始（10月上旬 - 1月下旬）
  - 10月：上市初期
  - 11-12月：盛產期、銷售旺季
  - 1月：產季尾聲

#### Q1 (1-3月) - 冬春季
- **柿子**：銷售尾聲（10月 - 1月下）
  - 1月中旬至下旬：產季結束

- **準備期**：所有水果進入冬季維護
  - 2-3月：修剪、施肥、土壤改良準備

---

## 📅 綜合生產銷售行事曆

```
月份      | 活動/生產狀況
----------|-------------------------------------------------------
1月上旬   | 柿子供應結束、冬季修剪期開始
1月中下旬 | 全面進入冬季維護、準備春季
2-3月     | 休眠期、修剪、施肥、培養、規劃夏季

4月       | 春季管理、水蜜桃花期管理、人工授粉
5月       | 疏果、套袋、施肥、蓄能準備
6月       | 水蜜桃上市（中旬開始）、盛產期準備

7月       | 水蜜桃盛產、主要銷售季
8月       | 水蜜桃持續銷售、水梨上市、冷藏備貨
9月       | 水蜜桃銷售結束、水梨進入盛產、蜜蘋果上市初期

10月      | 水梨盛產、蜜蘋果進入盛產、柿子上市
11月      | 水梨銷售結束、蜜蘋果盛產、柿子盛產
12月      | 蜜蘋果銷售結束、柿子持續銷售、冬季維護開始

年度淨銷售週期: 6月 - 1月 (8個月)
年度休閒期: 2月 - 5月 (4個月)
```

---

## 🎯 季節性行銷決策整合框架

### 季節行銷策略

#### 春季 (2-5月) 🌸
- **庫存狀況**：無新鮮水果庫存
- **銷售目標**：冷藏庫存促銷 + 客戶維繫
- **行銷策略**：
  - 保持 VIP 客戶聯繫（預購預告）
  - 推送上市倒計時
  - 清理冬季剩餘庫存
- **系統建議**：
  - 庫存預警：剩餘冷藏品降價銷售
  - CRM 行動：新鮮水果即將上市宣傳

#### 夏季 (6-8月) ☀️
- **庫存狀況**：水蜜桃盛產、高庫存
- **銷售目標**：最大化銷量
- **行銷策略**：
  - VIP 優先預購
  - 散客促銷（B/C 級別折扣）
  - 批發通路重點投入
- **系統建議**：
  - 高庫存警示：啟動促銷降價
  - 訂單優先度：Pending 加快確認
  - 決策卡片：重點推進銷售推進建議

#### 秋季 (9-11月) 🍂
- **庫存狀況**：多品項交替上市（水梨、蜜蘋果、柿子）
- **銷售目標**：品項多樣化、客群分層銷售
- **行銷策略**：
  - A 級果銷往 VIP 客戶、高端通路
  - B 級果銷往穩定客群、零售
  - C 級果用於促銷、散客
- **系統建議**：
  - 品級分層決策：按品級推薦客群
  - 補貨建議：監控各品項庫存
  - 客群策略：Stable 客户推「秋果組合」

#### 冬季 (12-1月) ❄️
- **庫存狀況**：蜜蘋果銷售結束、柿子長期保鮮
- **銷售目標**：消化剩餘庫存 + 節日促銷
- **行銷策略**：
  - 聖誕/跨年禮盒包裝
  - 新年禮品組合
  - At Risk 客戶回饋優惠
- **系統建議**：
  - 庫存清理：臨期品特價
  - CRM 行動：年底客戶感謝活動
  - 決策建議：評估新年採購計畫

---

## 🔄 系統決策流程圖

### 日常決策流程

```
[開啟系統] 
  ↓
[首頁儀表板]
  ├─ 庫存水位分析
  │  ├─ 補貨建議（低<50）
  │  ├─ 促銷建議（高>200）
  │  └─ 正常監控（50-200）
  ├─ 訂單優先度（Pending優先）
  ├─ 客群行動（按分級推薦）
  └─ AI 顧問（自由提問）

[周期性動作]
  ├─ 每日
  │  ├─ 檢查 pending 訂單（Dashboard）
  │  ├─ 確認庫存預警（Inventory）
  │  └─ 記錄農務日誌（Production）
  ├─ 每週
  │  ├─ 庫存盤點
  │  ├─ 通路分析（Orders）
  │  └─ 健康度檢查（Production）
  └─ 每月
     ├─ RFM 分級更新（CRM）
     ├─ 績效審視（Dashboard）
     └─ 季節策略調整

[決策支援]
  ├─ 庫存不足？ → 補貨建議 → 採購
  ├─ 庫存過多？ → 促銷建議 → 降價/禮盒
  ├─ 訂單積壓？ → 優先度排序 → 加快確認/揀貨
  ├─ 客戶流失？ → RFM 分級 → At Risk 回饋活動
  └─ 不確定？ → AI 顧問 → 取得專業建議
```

---

## 💡 理論依據與最佳實踐

### 應用的管理理論

| 理論 | 應用場景 | 收益 |
|------|--------|------|
| **RFM 分析法** | CRM 客戶分級 | 精準行銷、提升客單價 |
| **庫存 ABC 分類** | Dashboard/Inventory | 優化資本配置、降低持有成本 |
| **Economic Order Quantity (EOQ)** | 補貨決策 | 最小化訂購+持有成本 |
| **預防性農業 (Preventive Farming)** | Production 健康度管理 | 提升產量、降低病害損失 |
| **多通路策略 (Omnichannel)** | Orders 通路分析 | 擴大銷售覆蓋、客群多樣化 |
| **客戶生命周期價值 (CLV)** | CRM 分級與策略 | 長期利潤最大化 |
| **季節性需求管理** | 年度行事曆 | 提前規劃、優化現金流 |

---

## ⚠️ 關鍵決策指標 (KPI)

### 系統監控指標

| KPI | 定義 | 計算公式 | 目標 | 頻率 |
|-----|------|--------|------|------|
| **庫存周轉率** | 庫存轉動快度 | COGS / Avg Inventory | > 4 次/年 | 月 |
| **缺貨率** | 缺貨訂單比例 | Out-of-stock Orders / Total Orders | < 5% | 日 |
| **客戶轉化率** | New → Regular | Converted / New Customers | > 30% | 月 |
| **客戶留存率** | 持續購買比例 | Returning Customers / Previous Period | > 70% | 月 |
| **客單價** | 平均訂單金額 | Total Revenue / Order Count | ↑ 趨勢 | 週 |
| **訂單履行率** | 完整訂單比例 | Completed Orders / Total Orders | > 95% | 日 |
| **銷售集中度** | VIP 客群貢獻率 | VIP Revenue / Total Revenue | 40-50% | 月 |
| **庫存陳舊率** | 滯銷品比例 | Slow-moving SKUs / Total SKUs | < 10% | 月 |

---

## 📋 實施建議

### 短期 (1-3月)
1. ✅ 根據本框架調整 Dashboard 決策建議邏輯
2. ✅ 在 CRM 頁面新增季節提示
3. ✅ 在 Inventory 新增生產週期篩選

### 中期 (3-6月)
1. 建立季節性行銷自動化（郵件、推播）
2. 集成生產週期到 Planning 模組
3. 新增預測性庫存建議（基於歷史銷售）

### 長期 (6+月)
1. 建立完整的 KPI 儀表板
2. 實施機器學習預測模型
3. 開發客戶分群的自動行銷流程

