# 🎯 FruitOPS 新功能測試指南

## 功能 1️⃣：客戶分級系統 (RFM)

### 概念
- **R (Recency)**：最近購買日期（天數越少越有價值）
- **F (Frequency)**：購買頻率（次數越多越穩定）
- **M (Monetary)**：消費金額（金額越高越重要）

系統根據 RFM 自動將客戶分為 4 級：
- 🟣 **VIP**：消費 ≥ 100k，購買 ≥ 5 次，最近 ≤ 60 天
- 🔵 **Stable（穩定客群）**：消費 ≥ 50k，購買 ≥ 3 次，最近 ≤ 90 天
- 🟢 **New（新客）**：無購買紀錄
- 🔴 **At Risk（流失風險）**：最後購買超過 180 天

### 如何使用

#### 方式 1：自動計算 RFM 分級
1. 進入「顧客關係管理」頁面
2. 點擊「計算 RFM 分級」按鈕
3. 等待系統分析客戶的 Recency、Frequency、Monetary 數據
4. 預覽視窗會顯示每位客戶的新分級
5. 點擊「應用分級」確認變更

#### 方式 2：手動調整單個客戶分級
1. 在客戶卡片的下方找到「快速調整分級」下拉選單
2. 選擇新的分級等級（VIP、穩定客群、新客、流失風險）
3. 自動保存，Toast 會提示成功

#### 決策建議
- **挽回 At Risk 客戶**：傳送回饋優惠、節日促銷
- **培養 New 客戶**：首次購買折扣、產品推薦
- **保留 VIP 客戶**：專屬預購會、高端禮盒、客製化服務
- **穩定 Stable 客戶**：定期優惠、新品搶先看

---

## 功能 2️⃣：全域 Toast 提示通知

### 概念
應用涉及用戶填寫內容的所有操作，都會顯示成功/失敗提示。

### 支持的操作

#### ✅ 農務日誌 (Production)
- 新增日誌 → 「農務日誌已新增」
- 編輯日誌 → 「農務日誌已更新」或「更新失敗」

#### ✅ 庫存調整 (Inventory)
- 新增庫存 → 「庫存已新增」
- 移位 → 「庫存已移動」
- 上述操作失敗 → 「保存失敗」、「移動失敗」

#### ✅ 訂單管理 (Orders)
- 建立訂單 → 「訂單已建立」
- 狀態更新 → 「訂單狀態已更新」
- 完成揀貨 → 「訂單揀貨已完成」
- 上述操作失敗 → 相應的失敗提示

#### ✅ 客戶管理 (CRM)
- 計算 RFM → 「RFM 分級已計算」
- 應用分級 → 「分級已應用」
- 手動調整分級 → 「客戶分級已更新」

### Toast 外觀
- 🟢 **Success（成功）**：綠色背景 + 勾選圖標
- 🔴 **Error（失敗）**：紅色背景 + 警告圖標
- 🟡 **Warning（警告）**：黃色背景 + 三角圖標
- 🔵 **Info（資訊）**：藍色背景 + 圓圈圖標

### Toast 自動消失
- 預設 4 秒自動消失
- 支持手動點擊 ✕ 按鈕關閉
- 多個 Toast 會堆疊顯示在右上角

### 技術細節
```typescript
// 在元件內取得全域 Toast 實例
import { getGlobalToast } from '../services/toastHelpers';

const toast = getGlobalToast();
toast.addToast('success', '標題', '詳細訊息', 4000); // 自動消失
toast.addToast('error', '錯誤', '無法保存', 0);     // 不自動消失
```

---

## 測試清單 ☑️

### 基本功能測試
- [ ] 進入 CRM 頁面，確認「計算 RFM 分級」按鈕可見
- [ ] 點擊按鈕，等待計算完成
- [ ] 預覽視窗顯示每位客戶的 RFM 分析
- [ ] 「應用分級」按鈕已啟用
- [ ] 點擊應用後，客戶分級自動更新
- [ ] 看到成功 Toast「分級已應用」

### 手動調整測試
- [ ] 在客戶卡片的下拉選單選擇新分級
- [ ] 立即看到 Toast「客戶分級已更新」
- [ ] 客戶卡片上的分級標籤也隨之更新

### 農務日誌 Toast 測試
- [ ] 打開生產管理頁面，點擊「新增日誌」
- [ ] 填寫表單並提交
- [ ] 看到 Toast「農務日誌已新增」
- [ ] 編輯現有日誌，看到「農務日誌已更新」

### 庫存 Toast 測試
- [ ] 進入庫存頁面，點擊「新增庫存」
- [ ] 填寫表單並提交
- [ ] 看到 Toast「庫存已新增」
- [ ] 測試庫存移位，看到「庫存已移動」

### 訂單 Toast 測試
- [ ] 進入訂單頁面，創建新訂單
- [ ] 看到 Toast「訂單已建立」
- [ ] 更新訂單狀態
- [ ] 看到 Toast「訂單狀態已更新」
- [ ] 執行揀貨操作
- [ ] 看到 Toast「訂單揀貨已完成」

### 錯誤處理測試
- [ ] 嘗試提交不完整表單
- [ ] 看到相應的錯誤 Toast
- [ ] 網路中斷時的錯誤 Toast

---

## 部署檢查清單 ✅

- [x] 代碼已 commit 到 git main 分支
- [x] Vercel 已自動部署
- [x] https://fruit-ops.vercel.app 可訪問
- [x] 無控制台錯誤
- [x] Toast 通知正常顯示

---

## 後續優化建議 💡

1. **分級策略微調**：根據實際業務調整 RFM 閾值
2. **分級報表**：顯示分級分佈餅圖、趨勢
3. **自動分級任務**：設定每週自動重新計算
4. **分級行銷動作**：根據分級自動觸發行銷活動
5. **Toast 持久化**：重要操作的 Toast 設為不自動消失
6. **多語言 Toast**：支持繁體、簡體、英文
